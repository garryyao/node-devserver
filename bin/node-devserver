#!/usr/bin/env node

var path = require('path');
var fs = require('fs');
var util  = require('util');
var argv = require('optimist').argv;
var devserver = require('../lib/node-devserver');

var help = [
	"usage: node-devserver [options] ",
	"",
	"Starts a node-devserver server using the specified command-line options",
	"",
	"options:",
	"  --port   PORT       Port that the server should run on",
	"  --host   HOST       Host that the server server should run on",
	"  --config OUTFILE    Location of the configuration file for the server",
	"  -h, --help          You're staring at it"
].join('\n');

if (argv.h || argv.help || Object.keys(argv).length === 2) {
	return util.puts(help);
}

var config = {};
var port = argv.port || 80;
var host = argv.host || undefined;

if (argv.config) {
	try {
		var data = fs.readFileSync(argv.config);
		config = JSON.parse(data.toString());
	} catch (ex) {
		util.puts('Error starting node-devserver: ' + ex);
		process.exit(1);
	}
}

var server = new devserver(config);

if (host) {
	server.listen(port, host)
}
else {
	server.listen(port);
}

util.puts('node-devserver now listening on port: ' + port);
